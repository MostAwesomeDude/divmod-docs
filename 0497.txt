= [wiki:WikiStart Divmod] : [wiki:DivmodNevow Nevow] : Form Handling (A summary of Nevow form handling techniques) =
'''There is no one correct way to handle forms in Nevow'''. There follows a short tutorial on form handling in Nevow. It includes some real world problems and (hopefully) demonstrates some appropriate form handling solutions. Examples are included on separate wiki pages for clarity and to make it easy for the reader to download and run them. 
== Automatic Form Generation and Handling ==
There are two Nevow form handling libraries, '''Formless''' and [http://forms-project.pollenation.net/ Pollenation Forms]. Both offer automatic form generation, validation and type coercion. 

Formless is older and comes bundled with Nevow but can be confusing for beginners and frustrating for more experienced users. That said, it is highly customisable and allows html coder to precisely layout the form while still taking advantage of the automatic validation and type coercion. 

Pollenation Forms is both simpler for the beginner and offers powerful features for the experienced user. It is the recommended form handling library for those who do not need precise customisation of the form layout in the document template.
== A Note About Formless !TypedInterfaces ==
One of the original goals for Formless was that as well as web forms, it should be flexible enough to handle forms for other user interfaces eg curses, gtk. The idea was that the developer should create a !TypedInterface (an enhanced Zope Interface) describing the signature of a method that might be called in response to a form submission. By implementing this interface in a Nevow.rend.Page, the developer could present a web UI. Elsewhere the same !TypedInterface could be implemented to provide a gtk UI for example. In practice though, only the web form rendering code was maintained.

Recently '''!TypedInterface has been deprecated in favour of the newer and simpler bind_* syntax'''. (see [source:trunk/Nevow/ChangeLog Nevow Changlog 2005-07-12]) Confusingly for the beginner, most of the Nevow examples still use !TypedInterfaces, but hopefully these will be updated in due course.

In the rest of this document we will use only the new bind_* syntax.

== Example 1: A News Item Editor Page ==
The following example demonstrates the simplest use of Formless / Pollenation Forms. 
 * [wiki:DivmodNevow/FormHandling/Example1.tac?version=1 We start with a simple page containing everything but the form]. This contains:
   * the rend.Page subclass
   * a docFactory
   * a simple list to store news items
   * a data_* method to expose the list of stories to the template
   * a method to save new items to the database and who redirects to a completion page on success

 * [wiki:DivmodNevow/FormHandling/Example1.tac?action=diff&old_version=2&version=1 To expose the method (saveNewsItem) in our web page with Formless] we:
   * import annotate and webform from the formless module
   * update the template to include form layout css and a placeholder for our form renderer
   * add the Formless standard css file as a static resource child
   * define a corresponding bind_saveNewsItem method whose job is to return a description of the saveNewsItem method arguments
   * define a custom renderer which adds the results of webform.renderForms() to the page output.

== Manual Form Handling ==
Sometimes a form is so simple that it is easiest to write the form html by hand and handle the result manually. The following code demonstrates a  form with which the user can choose his preferred number of items per page in a datagrid.

 * [wiki:DivmodNevow/FormHandling/Examples/ManualFormHandling.tac ManualFormHandling.tac]

The <select> tag has a javascript onchange handler to automatically submit it's parent form and is presented inline with the content of its parent <p> tag. To achieve this automatically using webform.renderForms() would have required defining a custom form template with custom patterns etc (see later example). 

(It should be noted that freeform annotated types can be used in isolation from the form rendering machinery for automatic coercion and validation of the form variables. An example of this may be added later.)