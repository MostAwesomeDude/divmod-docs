= [wiki:WikiStart Divmod] : [wiki:DivmodNevow Nevow] : Deployment Techniques =
A summary of Nevow deployment techniques
== Reverse Proxy with [http://lighttpd.net/ Lighttpd] and VHostMonsterResource ==
 '''Rationale'''::
  I have a server running Lighttpd on port 80, doing [http://httpd.apache.org/docs/2.0/vhosts/name-based.html name based virtual hosting] of several existing websites. I want to add a new Nevow based website (www.example.com).
 '''Solution'''::
  Lighttpd provides a [http://lighttpd.net/documentation/proxy.html proxy module] which can forward incoming requests to a slave webserver. The resulting content may contain absolute urls which must be rewritten before being returned to the client. This is handled by Nevow.vhost.VHostMonsterResource.
  === Nevow App: ===
  {{{
#!python
from twisted.application import service, strports
 
from nevow import appserver, rend, tags, loaders, vhost

class MyPage(rend.Page):
    addSlash = True
    def __init__(self, *args, **kw):
        content = kw.get('content', '')
        del kw['content']
        self.docFactory = loaders.stan(
            tags.html[
                tags.head[tags.title[content]],
                tags.body[
                    tags.h1[content]
                ]
            ]
        )
        rend.Page.__init__(self, *args, **kw)

siteRoot = MyPage(content='My Root Page')
siteRoot.putChild('vhost', vhost.VHostMonsterResource())
application = service.Application('reverse proxy / vhost example')
strports.service('8080', appserver.NevowSite(siteRoot)).setServiceParent(application)
}}}
  === Lighttpd Config: ===
  {{{
$HTTP['host'] =~ '^(www.example.com)$' {
        url.rewrite-once = ('^/(.*)' => '/vhost/http/%0/$1')
        proxy.server = ( '' =>
                ( (
                'host' => '127.0.0.1',
                'port' => 8080
                ) )
        )
}
}}}
== See Also ==
 * http://divmod.org/users/exarkun/nevow-doc/nevow-deployment.html
 * http://divmod.org/users/wiki.twistd/nevow/moin.cgi/ApacheSetup
 * http://old.bougyman.com/RailsonDebian.html (You're not going to bother with Rails obviously, but this is a useful guide to installing lighttpd)