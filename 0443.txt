= [wiki:DivmodNevow/Deployment Nevow Deployment] : Reverse Proxy =
A Reverse Proxy forwards the requests it receives from the internet to one or more slave webservers. Lighttpd and Apache both provide reverse proxy modules. Any absolute urls in the response will contain the [http://en.wikipedia.org/wiki/URL#URL_scheme scheme] (possibly the hostname) and port number on which the slave is running. These must be rewritten before being returned to the client. In Nevow this can be handled by [source:trunk/Nevow/nevow/vhost.py vhost.VHostMonsterResource]. 
== Example 1 ==
You have an existing webserver running on port 80, doing [http://httpd.apache.org/docs/2.0/vhosts/name-based.html name based virtual hosting] of several existing websites and want to run a Nevow based site alongside them on the same IP.
== Solution ==
Forward all requests at this virtual host to the Nevow slave server.
=== Sample Nevow App ===
{{{
#!python
from twisted.application import service, strports
 
from nevow import appserver, rend, tags, loaders, vhost

class MyPage(rend.Page):
    addSlash = True
    def __init__(self, *args, **kw):
        content = kw.get('content', '')
        del kw['content']
        self.docFactory = loaders.stan(
            tags.html[
                tags.head[tags.title[content]],
                tags.body[
                    tags.h1[content]
                ]
            ]
        )
        rend.Page.__init__(self, *args, **kw)

siteRoot = MyPage(content='My Root Page')
siteRoot.putChild('vhost', vhost.VHostMonsterResource())
application = service.Application('reverse proxy / vhost example')
strports.service('8080', appserver.NevowSite(siteRoot)).setServiceParent(application)
}}}
Save as eg sample.tac and run using twistd -noy sample.tac
=== Sample Lighttpd Config: ===
{{{
$HTTP['host'] =~ '^(www.example.com)$' {
        url.rewrite-once = ('^/(.*)' => '/vhost/http/%0/$1')
        # In lighttpd we alter the path manually using rewrite rule. %0 refers to the hostname and $1 is the path.
        proxy.server = ( '' =>
                ( (
                'host' => '127.0.0.1',
                'port' => 8080
                ) )
        )
}
}}}
=== Sample Apache Config ([http://divmod.org/users/wiki.twistd/nevow/moin.cgi/ApacheSetup Ref]) ===
{{{
<VirtualHost www.example.com>
ProxyPass / http://localhost:8080/vhost/http/www.example.com/
ServerName www.example.com
</VirtualHost>
}}}
== Example 2 ==
Nevow is only to be used for part of an existing static site at a non-root url
=== Sample Lighttpd Config: ===
TODO
=== Sample Apache Config ===
TODO
== See Also ==
 * http://lighttpd.net/documentation/proxy.html
 * http://httpd.apache.org/docs/2.0/mod/mod_proxy.html#proxypass